# –®–Ü –†—ñ—î–ª—Ç–æ—Ä

–Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏–π Telegram-–±–æ—Ç, —è–∫–∏–π —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é, —Å—Ç–∞–≤–∏—Ç—å —à—ñ—Å—Ç—å –¥—ñ–∞–ª–æ–≥–æ–≤–∏—Ö –ø–∏—Ç–∞–Ω—å, –∑–±–∏—Ä–∞—î –∫–æ–Ω—Ç–∞–∫—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ —Å–µ—Ä–≤—ñ—Å—É –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é —Ä–æ–∑–º–æ–≤ —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
app/
  __init__.py
  main.py
  bot/
    loader.py
    handlers.py
    states.py
    keyboards.py
  core/
    config.py
    sheets.py
    llm.py
    rules.py
  db/
    __init__.py
    base.py
    models.py
    crud.py
    migrations/
  services/
    filters.py
    api_client.py
    listings.py
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –∞–±–æ –∑–∞–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

- `TELEGRAM_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞.
- `TELEGRAM_WEBHOOK_URL` ‚Äî –ø–æ–≤–Ω–∞ URL-–∞–¥—Ä–µ—Å–∞ –≤–µ–±—Ö—É–∫–∞ FastAPI.
- `TELEGRAM_WEBHOOK_PATH` ‚Äî —à–ª—è—Ö –≤–µ–±—Ö—É–∫–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `/webhook`).
- `DATABASE_URL` ‚Äî —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL –∞–±–æ —ñ–Ω—à–æ—ó —Å—É–º—ñ—Å–Ω–æ—ó –°–£–ë–î.
- `GOOGLE_SPREADSHEET_ID` ‚Äî —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä Google Spreadsheet –∑ —Ç–µ–∫—Å—Ç–∞–º–∏ –¥—ñ–∞–ª–æ–≥—É.
- `GOOGLE_SERVICE_ACCOUNT_JSON` ‚Äî JSON —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç–∞ Google —É –≤–∏–≥–ª—è–¥—ñ —Ä—è–¥–∫–∞.
- `LISTINGS_API_URL` ‚Äî –∞–¥—Ä–µ—Å–∞ POST-–µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞ –¥–ª—è –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `https://bots2.tira.com.ua:8443/api/get_apartments`).
- `LISTINGS_API_KEY` ‚Äî –∫–ª—é—á –¥–æ—Å—Ç—É–ø—É –¥–æ API (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `tsj3HsMqL136cMxhf5zwcFdniz7a`).

## –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
   ```bash
   pip install -e .
   ```
2. –°—Ç–≤–æ—Ä—ñ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î (migrations —Å–ª—É–≥—É—î –º—ñ—Å—Ü–µ–º –¥–ª—è alembic-—Å–∫—Ä–∏–ø—Ç—ñ–≤):
   ```bash
   python -c "from app.db.base import Base, engine; Base.metadata.create_all(bind=engine)"
   ```
3. –†–æ–∑–≥–æ—Ä–Ω—ñ—Ç—å FastAPI –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —ñ–∑ –≤–µ–±—Ö—É–∫–æ–º Telegram (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ `uvicorn`):
   ```bash
   uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```
4. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤–µ–±—Ö—É–∫ –±–æ—Ç–∞ –Ω–∞ URL `TELEGRAM_WEBHOOK_URL`.

## –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- –í—ñ—Ç–∞–ª—å–Ω—ñ —Ç–µ–∫—Å—Ç–∏, –ø–∏—Ç–∞–Ω–Ω—è, –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è —Ç–∞ —Ä–µ–∞–∫—Ü—ñ—ó –¥–∏–Ω–∞–º—ñ—á–Ω–æ –±–µ—Ä—É—Ç—å—Å—è –∑ Google Spreadsheet.
- –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è —É —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–ª—è API –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ, –≤–∫–ª—é—á–Ω–æ –∑ —Ä–∞–π–æ–Ω–Ω–∏–º–∏ —Ç–∞ –≤—É–ª–∏—á–Ω–∏–º–∏ –¥–æ–≤—ñ–¥–Ω–∏–∫–∞–º–∏.
- –ü—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —É—Å—ñ—Ö —à–µ—Å—Ç–∏ –ø–∏—Ç–∞–Ω—å –±–æ—Ç –ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ `üìû –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º`.
- –ù–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É —ñ–Ω—ñ—Ü—ñ—é—î POST-–∑–∞–ø–∏—Ç –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É –∑ –ª—ñ–º—ñ—Ç–æ–º 3 —Ç–∞ offset 0 —ñ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è–º payload/response.
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î —Ç—Ä–∏ –∫–∞—Ä—Ç–∫–∏ –Ω–µ—Ä—É—Ö–æ–º–æ—Å—Ç—ñ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π.
- –£ –±–∞–∑—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –¥—ñ–∞–ª–æ–≥–∏, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ñ—ñ–ª—å—Ç—Ä–∏, –≤–∏–∫–ª–∏–∫–∏ API —Ç–∞ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –ø–µ—Ä–µ–≥–ª—è–¥.

## –†–æ–∑—Ä–æ–±–∫–∞

- –í—Å—ñ –º–æ–¥—É–ª—ñ –Ω–∞–ø–∏—Å–∞–Ω—ñ –±–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —Ç–∞ —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –∑–∞ —Å—Ñ–µ—Ä–∞–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ.
- –õ–æ–≥—ñ–∫–∞ –¥—ñ–∞–ª–æ–≥—É –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ `aiogram` FSM, –∞ FastAPI –æ–±—Ä–æ–±–ª—è—î –≤–µ–±—Ö—É–∫ Telegram.
- –î–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Google Sheets –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `gspread` —ñ–∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º.
- SQLAlchemy –∑–∞–±–µ–∑–ø–µ—á—É—î ORM-–º–æ–¥–µ–ª—ñ –π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω—É —Ä–æ–±–æ—Ç—É –∑ –±–∞–∑–æ—é.

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
python -m compileall app
```

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –≥–∞—Ä–∞–Ω—Ç—É—î –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ –ø–µ—Ä–µ–¥ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è–º.

## Docker

1. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –∑–∞ –∑—Ä–∞–∑–∫–æ–º –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤ –Ω—å–æ–º—É —î `TELEGRAM_TOKEN` —ñ `GOOGLE_SERVICE_ACCOUNT_JSON`.
2. –ü–æ–±—É–¥—É–π—Ç–µ —Ç–∞ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏:
   ```bash
   docker compose up --build
   ```
3. FastAPI –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ –ø–æ—Ä—Ç—É `8000`, –∞ PostgreSQL ‚Äî –Ω–∞ `5432`.
